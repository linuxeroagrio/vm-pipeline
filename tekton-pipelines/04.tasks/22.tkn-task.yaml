apiVersion: tekton.dev/v1
kind: Task
metadata:
  annotations:
    tekton.dev/categories: CLI
    tekton.dev/displayName: Tekton CLI
    tekton.dev/pipelines.minVersion: 0.17.0
    tekton.dev/platforms: linux/amd64,linux/s390x,linux/ppc64le
    tekton.dev/tags: cli
  labels:
    app.kubernetes.io/version: "0.4"
  name: tkn
  namespace: vm-pipelines
spec:
  description: This task performs operations on Tekton resources using tkn
  params:
  - default: gcr.io/tekton-releases/dogfooding/tkn@sha256:d17fec04f655551464a47dd59553c9b44cf660cc72dbcdbd52c0b8e8668c0579
    description: tkn CLI container image to run this task
    name: TKN_IMAGE
    type: string
  - default: tkn $@
    description: tkn CLI script to execute
    name: SCRIPT
    type: string
  - default:
    - --help
    description: tkn CLI arguments to run
    name: ARGS
    type: array
  steps:
  - args:
    - $(params.ARGS)
    computeResources: {}
    env:
    - name: HOME
      value: /tekton/home
    image: $(params.TKN_IMAGE)
    name: tkn
    script: |
      if [ "$(workspaces.kubeconfig.bound)" = "true" ] && [ -e $(workspaces.kubeconfig.path)/kubeconfig ]; then
        export KUBECONFIG="$(workspaces.kubeconfig.path)"/kubeconfig
      fi

      eval "$(params.SCRIPT)"
    securityContext:
      runAsNonRoot: true
      runAsUser: 65532
  workspaces:
  - description: An optional workspace that allows you to provide a .kube/config file
      for tkn to access the cluster. The file should be placed at the root of the
      Workspace with name kubeconfig.
    name: kubeconfig
    optional: true
